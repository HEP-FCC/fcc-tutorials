

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.2. FCC: Getting started with simulating events in Delphes &mdash; FCC Tutorials  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/custom-admonitions.css?v=e6bfab01" />

  
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../../_static/copybutton.js?v=f281be69"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../../../../../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="2.3. Understanding generated process: eedE" href="../../../../eedE.html" />
    <link rel="prev" title="2.1. FCC: Getting started with event generation" href="../../../../FccFastSimGeneration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            FCC Tutorials
              <img src="../../../../../_static/fcc-logo-light.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../../software-basics/README.html">1. First Steps</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../README.html">2. Generators, Fast Simulation and Analysis</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../FccFastSimGeneration.html">2.1. FCC: Getting started with event generation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">2.2. FCC: Getting started with simulating events in Delphes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generate-and-simulate-events-with-delphesedm4hep">2.2.1. Generate and Simulate Events with DelphesEDM4Hep</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-generation-pythia8-evtgen">2.2.2. Sample Generation: Pythia8 + EvtGen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-custom-decay-file">2.2.3. Creating custom decay file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../eedE.html">2.3. Understanding generated process: eedE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../fccanalyses/doc/starterkit/FccFastSimAnalysis/Readme.html">2.4. FCC: Analysing simulated events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../FccFastSimVertexing/Readme.html">2.5. Tracking and vertexing example using specific flavour decays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../FCCAnalysesProblemsAndSolutions.html">2.6. FCCAnalyses: Common problems and solutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../EventProduction.html">2.7. Central production of events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../full-detector-simulations/README.html">3. Full Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../distributed-computing/README.html">4. Distributed computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developing-fcc-software/README.html">5. Developing FCCSW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../CONTRIBUTING.html">6. Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://fccsw.web.cern.ch/">FCC Software</a></li>
<li class="toctree-l1"><a class="reference external" href="https://fcc-ee-detector-full-sim.docs.cern.ch/">FCC-ee Detector Full Sim</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/FCCAnalyses/">FCCAnalyses</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/glossary">FCC Software glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">FCC Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../README.html"><span class="section-number">2. </span>Generators, Fast Simulation and Analysis</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.2. </span>FCC: Getting started with simulating events in Delphes</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/HEP-FCC/fcc-tutorials/blob/main/fast-sim-and-analysis/k4simdelphes/doc/starterkit/FccFastSimDelphes/Readme.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="fcc-getting-started-with-simulating-events-in-delphes">
<h1><span class="section-number">2.2. </span>FCC: Getting started with simulating events in Delphes<a class="headerlink" href="#fcc-getting-started-with-simulating-events-in-delphes" title="Link to this heading"></a></h1>
<div class="objectives admonition">
<p class="admonition-title">Learning Objectives</p>
<p>This tutorial will teach you how to:</p>
<ul class="simple">
<li><p><strong>generate</strong> signal and background samples with <strong>Pythia8</strong> with and without EvtGen</p></li>
<li><p>run a fast parametric <strong>detector simulation</strong> with <strong>Delphes</strong> in the EDM4Hep format</p></li>
<li><p>apply an <strong>event selection</strong> on those samples with <strong>FCCAnalyses</strong></p></li>
<li><p>produce <strong>flat ntuples</strong> with observables of interest with <strong>FCCAnalyses</strong></p></li>
<li><p>produce plots with <strong>FCCAnalyses</strong></p></li>
</ul>
</div>
<p>First login to a fresh shell on lxplus, on OSG, or in one of the virtual machines that could be provided on open stack. Usage of bash shell is highly recommended. Create a working directory and go inside</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">mytutorial</span>
<span class="n">cd</span> <span class="n">mytutorial</span>
</pre></div>
</div>
<p>Then, make sure your <strong>setup of the FCC software</strong> is working correctly. A quick check is that the executable <code class="docutils literal notranslate"><span class="pre">DelphesPythia8_EDM4HEP</span></code>, which allows you to run jobs in the EDM4Hep format is available on the command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>which<span class="w"> </span>DelphesPythia8_EDM4HEP
</pre></div>
</div>
<p>If the above command fails without printing a path like <code class="docutils literal notranslate"><span class="pre">/cvmfs/sw.hsf.org/spackages7/k4simdelphes/00-03-01/x86_64-centos7-gcc11.2.0-opt/7he4m/bin/DelphesPythia8_EDM4HEP</span></code>, you need to setup the FCC software stack</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">cvmfs</span><span class="o">/</span><span class="n">fcc</span><span class="o">.</span><span class="n">cern</span><span class="o">.</span><span class="n">ch</span><span class="o">/</span><span class="n">sw</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>When sourcing the stack, you should see a message like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="o">...</span>  <span class="n">Key4HEP</span> <span class="n">release</span><span class="p">:</span> <span class="n">key4hep</span><span class="o">-</span><span class="n">stack</span><span class="o">/</span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">08</span>
 <span class="o">...</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">following</span> <span class="n">command</span> <span class="n">to</span> <span class="n">reproduce</span> <span class="n">the</span> <span class="n">current</span> <span class="n">environment</span><span class="p">:</span> 
 <span class="o">...</span>
         <span class="n">source</span> <span class="o">/</span><span class="n">cvmfs</span><span class="o">/</span><span class="n">sw</span><span class="o">.</span><span class="n">hsf</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">spackages7</span><span class="o">/</span><span class="n">key4hep</span><span class="o">-</span><span class="n">stack</span><span class="o">/</span><span class="mi">2023</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">08</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">centos7</span><span class="o">-</span><span class="n">gcc11</span><span class="mf">.2.0</span><span class="o">-</span><span class="n">opt</span><span class="o">/</span><span class="n">urwcv</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
 <span class="o">...</span>
 <span class="o">...</span> <span class="n">done</span><span class="o">.</span>
</pre></div>
</div>
<p>which means that the version <code class="docutils literal notranslate"><span class="pre">2023-04-08</span></code> of <code class="docutils literal notranslate"><span class="pre">key4hep-stack</span></code> is sourced.</p>
<section id="generate-and-simulate-events-with-delphesedm4hep">
<span id="delphesedm4hep"></span><h2><span class="section-number">2.2.1. </span>Generate and Simulate Events with DelphesEDM4Hep<a class="headerlink" href="#generate-and-simulate-events-with-delphesedm4hep" title="Link to this heading"></a></h2>
<p>For this tutorial we will consider the following <strong>physics processes</strong>:</p>
<ul class="simple">
<li><p>e+ e- -&gt; ZH -&gt; Z and H to anything</p></li>
<li><p>e+ e- -&gt; ZZ -&gt; Z to anything</p></li>
<li><p>e+ e- -&gt; WW -&gt; W to anything</p></li>
</ul>
<p>Let’s start by downloading the official pythia cards for the various processes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_ZH_ecm240.cmd
wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_ZZ_ecm240.cmd
wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_WW_ecm240.cmd
</pre></div>
</div>
<p>The detector response of the baseline FCC-ee IDEA detector configuration is estimated with Delphes.
Other detector cards can be found in the <code class="docutils literal notranslate"><span class="pre">$DELPHES_DIR/cards</span></code> directory, such as a ATLAS, CMS or ILD detector configurations:
<code class="docutils literal notranslate"><span class="pre">delphes_card_ATLAS.tcl</span></code>, <code class="docutils literal notranslate"><span class="pre">delphes_card_CMS.tcl</span></code> and <code class="docutils literal notranslate"><span class="pre">delphes_card_ILD.tcl</span></code>.</p>
<p>But let’s download the official one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/card_IDEA.tcl
</pre></div>
</div>
<p>To check the arguments ordering, please run the executable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DelphesPythia8_EDM4HEP</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>it should produce the following message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">DelphesPythia8config_file</span> <span class="n">output_config_file</span> <span class="n">pythia_card</span> <span class="n">output_file</span>
<span class="n">config_file</span> <span class="o">-</span> <span class="n">configuration</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">Tcl</span> <span class="nb">format</span><span class="p">,</span>
<span class="n">output_config_file</span> <span class="o">-</span> <span class="n">configuration</span> <span class="n">file</span> <span class="n">steering</span> <span class="n">the</span> <span class="n">content</span> <span class="n">of</span> <span class="n">the</span> <span class="n">edm4hep</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">Tcl</span> <span class="nb">format</span><span class="p">,</span>
<span class="n">pythia_card</span> <span class="o">-</span> <span class="n">Pythia8</span> <span class="n">configuration</span> <span class="n">file</span><span class="p">,</span>
<span class="n">output_file</span> <span class="o">-</span> <span class="n">output</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ROOT</span> <span class="nb">format</span><span class="o">.</span>
</pre></div>
</div>
<p>where the first argument is the delphes card, the second argument the configuration file for the edm4hep output (see later), the third argument is the pythia card and the last argument is the output file name.</p>
<p>Before running we need to define the collections that we want to write. The first name for example <code class="docutils literal notranslate"><span class="pre">GenParticleCollections</span></code> is the type of output collection in EDM4hep (in this case <code class="docutils literal notranslate"><span class="pre">GenParticleCollections</span></code> is of type <code class="docutils literal notranslate"><span class="pre">edm4hep::MCParticleCollection</span></code>) and the second argument for example <code class="docutils literal notranslate"><span class="pre">Particle</span></code> is the name of the collection in the Delphes card that will be used and stored in the EDM4Hep output file with the same name.</p>
<p>We also download the official version of this file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/edm4hep_IDEA.tcl
</pre></div>
</div>
<p>The following commands will run Pythia8 and Delphes and produce the relevant signal and background samples:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DelphesPythia8_EDM4HEP<span class="w"> </span>card_IDEA.tcl<span class="w"> </span>edm4hep_IDEA.tcl<span class="w"> </span>p8_ee_ZH_ecm240.cmd<span class="w"> </span>p8_ee_ZH_ecm240_edm4hep.root
DelphesPythia8_EDM4HEP<span class="w"> </span>card_IDEA.tcl<span class="w"> </span>edm4hep_IDEA.tcl<span class="w"> </span>p8_ee_ZZ_ecm240.cmd<span class="w"> </span>p8_ee_ZZ_ecm240_edm4hep.root
DelphesPythia8_EDM4HEP<span class="w"> </span>card_IDEA.tcl<span class="w"> </span>edm4hep_IDEA.tcl<span class="w"> </span>p8_ee_WW_ecm240.cmd<span class="w"> </span>p8_ee_WW_ecm240_edm4hep.root
</pre></div>
</div>
</section>
<section id="sample-generation-pythia8-evtgen">
<h2><span class="section-number">2.2.2. </span>Sample Generation: Pythia8 + EvtGen<a class="headerlink" href="#sample-generation-pythia8-evtgen" title="Link to this heading"></a></h2>
<blockquote>
<div><p>Author: Vasilisa Guliaeva</p>
</div></blockquote>
<p>This part explains how to produce FCC-ee samples with
<a class="reference external" href="https://pythia.org/"><strong>Pythia8</strong></a> and
<a class="reference external" href="https://evtgen.hepforge.org"><strong>EvtGen</strong></a>, using the standard FCC configuration
files and <strong>EDM4hep</strong> output format.</p>
<p><a class="reference external" href="https://evtgen.hepforge.org/"><strong>EvtGen</strong></a> is a decay generator specialized in
the simulation of hadronic decays of heavy-flavour particles with accurate
angular correlations and form-factor models. <strong>EvtGen</strong> is interfaced to
<a class="reference external" href="https://github.com/HEP-FCC/k4Gen/blob/main/k4Gen/src/components/PythiaInterface.h#L88-L97"><strong>Pythia8</strong></a>
through <strong>k4Gen</strong>, so that events generated by <strong>Pythia</strong> can be decayed by
<strong>EvtGen</strong> before detector simulation.</p>
<p>We will generate a Monte Carlo sample of 1’000 events, matching the <code class="docutils literal notranslate"><span class="pre">winter2023</span></code> MC campaign, for <span class="math notranslate nohighlight">\(e^{+} e^{-} \;\rightarrow\; Z \;\rightarrow\; b\bar{b} \;\rightarrow\; B^{+} \;\rightarrow\; \tau^{+} \nu_{\tau} \;\rightarrow\; 3\pi\)</span>. All standard configuration files for FCC-ee Monte Carlo campaigns are provided in the <a class="reference external" href="https://github.com/HEP-FCC/FCC-config/tree/winter2023">FCC-config repository (winter2023 branch)</a>.</p>
<p>Open a new lxplus session. Create a working directory and enter it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>tutorialGen
<span class="nb">cd</span><span class="w"> </span>tutorialGen
</pre></div>
</div>
<p>Since the EDM4hep output card that maps Delphes collections into EDM4hep data structures depends on the software stack, we must use the <code class="docutils literal notranslate"><span class="pre">winter2023</span></code> MC campaign environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>/cvmfs/sw.hsf.org/spackages6/key4hep-stack/2022-12-23/x86_64-centos7-gcc11.2.0-opt/ll3gi/setup.sh
</pre></div>
</div>
<p><strong>Event generation</strong></p>
<p>To generate events with Pythia8 + EvtGen, use the executable
<code class="docutils literal notranslate"><span class="pre">DelphesPythia8EvtGen_EDM4HEP_k4Interface</span></code>. Make sure your shell environment is
correctly set up by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>which<span class="w"> </span>DelphesPythia8EvtGen_EDM4HEP_k4Interface
</pre></div>
</div>
<p>For our stack output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cvmfs</span><span class="o">/</span><span class="n">sw</span><span class="o">.</span><span class="n">hsf</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">spackages6</span><span class="o">/</span><span class="n">k4simdelphes</span><span class="o">/</span><span class="mi">00</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">00</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">centos7</span><span class="o">-</span><span class="n">gcc11</span><span class="mf">.2.0</span><span class="o">-</span><span class="n">opt</span><span class="o">/</span><span class="n">pqqvt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">DelphesPythia8EvtGen_EDM4HEP_k4Interface</span>
</pre></div>
</div>
<p>The executable wrapper that connects Pythia8, EvtGen, and Delphes, and writes
output in EDM4hep format. You can inspect its expected argument order by
running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DelphesPythia8EvtGen_EDM4HEP_k4Interface<span class="w"> </span>-h
</pre></div>
</div>
<div class="callout toggle admonition">
<p class="admonition-title"><code class="docutils literal notranslate"><span class="pre">DelphesPythia8EvtGen_EDM4HEP_k4Interface</span></code> CLI arguments</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DelphesPythia8EvtGen_EDM4HEP_k4Interface</span></code> takes the following CLI
arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">DelphesPythia8EvtGenconfig_file</span> <span class="n">output_config_file</span> <span class="n">pythia_card</span> <span class="n">output_file</span> <span class="n">DECAY</span><span class="o">.</span><span class="n">DEC</span> <span class="n">evt</span><span class="o">.</span><span class="n">pdl</span> <span class="n">user</span><span class="o">.</span><span class="n">dec</span>

<span class="n">config_file</span> <span class="o">-</span> <span class="n">configuration</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">Tcl</span> <span class="nb">format</span><span class="p">,</span>  
<span class="n">output_config_file</span> <span class="o">-</span> <span class="n">configuration</span> <span class="n">file</span> <span class="n">steering</span> <span class="n">the</span> <span class="n">content</span> <span class="n">of</span> <span class="n">the</span> <span class="n">edm4hep</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">Tcl</span> <span class="nb">format</span><span class="p">,</span>  
<span class="n">pythia_card</span> <span class="o">-</span> <span class="n">Pythia8</span> <span class="n">configuration</span> <span class="n">file</span><span class="p">,</span>  
<span class="n">output_file</span> <span class="o">-</span> <span class="n">output</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">ROOT</span> <span class="nb">format</span><span class="p">,</span>  
<span class="n">DECAY</span><span class="o">.</span><span class="n">DEC</span> <span class="o">-</span> <span class="n">EvtGen</span> <span class="n">full</span> <span class="n">decay</span> <span class="n">file</span><span class="p">,</span>  
<span class="n">evt</span><span class="o">.</span><span class="n">pdl</span> <span class="o">-</span> <span class="n">EvtGen</span> <span class="n">particle</span> <span class="nb">list</span><span class="p">,</span>  
<span class="n">user</span><span class="o">.</span><span class="n">dec</span> <span class="o">-</span> <span class="n">EvtGen</span> <span class="n">user</span> <span class="n">decay</span> <span class="n">file</span><span class="o">.</span>
</pre></div>
</div>
</div>
<p>To start the sample generation, we need to download the configuration files.</p>
<p>We begin with the Pythia8 card that defines the hard process <span class="math notranslate nohighlight">\(e^{+} e^{-} \;\rightarrow\; Z \;\rightarrow\; b\bar{b}\)</span> and enables the EvtGen interface for hadronic decays.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/Pythia8/p8_ee_Zbb_ecm91_EVTGEN.cmd
</pre></div>
</div>
<p>To limit the number of events for a local test, add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Main</span><span class="p">:</span><span class="n">numberOfEvents</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>Next, we download the Delphes detector description and the EDM4hep steering file, which together define the IDEA detector geometry and how Delphes collections (tracks, jets, leptons, etc.) are translated into EDM4hep structures:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/card_IDEA.tcl
wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Delphes/edm4hep_IDEA.tcl
</pre></div>
</div>
<p>EvtGen requires a set of text files containing decay tables, particle properties, and our custom decay definition for <span class="math notranslate nohighlight">\(B^{+} \;\rightarrow\; \tau^{+} \nu_{\tau} \;\rightarrow\; 3\pi\)</span> channel with a hadronic 3-prong tau decay  <span class="math notranslate nohighlight">\(\tau^{+} \;\rightarrow\; \pi^{+}\,\pi^{-}\,\pi^{+}\,\bar{\nu}_{\tau}\)</span>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/EvtGen/DECAY.DEC
wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/EvtGen/evt.pdl
wget<span class="w"> </span>https://raw.githubusercontent.com/HEP-FCC/FCC-config/winter2023/FCCee/Generator/EvtGen/Bu2TauNuTAUHADNU.dec
</pre></div>
</div>
<p>With all configuration files in place, we can now run the generation step using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DelphesPythia8EvtGen_EDM4HEP_k4Interface</span> <span class="n">card_IDEA</span><span class="o">.</span><span class="n">tcl</span> <span class="n">edm4hep_IDEA</span><span class="o">.</span><span class="n">tcl</span> \
<span class="n">p8_ee_Zbb_ecm91_EVTGEN</span><span class="o">.</span><span class="n">cmd</span> <span class="n">Bu2TauNuTAUHADNU</span><span class="o">.</span><span class="n">root</span> <span class="n">DECAY</span><span class="o">.</span><span class="n">DEC</span> <span class="n">evt</span><span class="o">.</span><span class="n">pdl</span> \
<span class="n">Bu2TauNuTAUHADNU</span><span class="o">.</span><span class="n">dec</span> <span class="mi">521</span> <span class="n">Bu_SIGNAL</span> <span class="mi">1</span>
</pre></div>
</div>
<p><strong>Explanation of arguments:</strong></p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Bu2TauNuTAUHADNU.root</span></code> — output EDM4hep file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">521</span></code> — PDG code of B⁺, the PDG code of the particle whose decays you want to override</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Bu_SIGNAL</span></code> — a label for the signal process used for bookkeeping in campaign production</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> — force custom decay (use <code class="docutils literal notranslate"><span class="pre">0</span></code> to disable)</p></li>
</ol>
</section>
<section id="creating-custom-decay-file">
<h2><span class="section-number">2.2.3. </span>Creating custom decay file<a class="headerlink" href="#creating-custom-decay-file" title="Link to this heading"></a></h2>
<p>The custom decay file <code class="docutils literal notranslate"><span class="pre">Bu2TauNuTAUHADNU.dec</span></code> specifies the decay <span class="math notranslate nohighlight">\(B^{+} \;\rightarrow\; \tau^{+} \nu_{\tau} \;\rightarrow\; 3\pi\)</span>. EvtGen uses a flexible text-based format to define particle decays, allowing users to override or extend the default decay tables. To do this safely — without altering the global definitions in <code class="docutils literal notranslate"><span class="pre">DECAY.DEC</span></code> — we use <strong>aliases</strong>, which act as local copies of particles. Using <strong>aliases</strong> ensures that only the selected signal <span class="math notranslate nohighlight">\(B^+\)</span> follow our custom decay chain, rather than forcing every <span class="math notranslate nohighlight">\(B^+\)</span> in a <span class="math notranslate nohighlight">\(Z \rightarrow b\bar{b}\)</span> event to decay the same way.</p>
<p><code class="docutils literal notranslate"><span class="pre">Bu2TauNuTAUHADNU.dec</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Alias</span>   <span class="n">Bu_SIGNAL</span>   <span class="n">B</span><span class="o">+</span>
<span class="n">Alias</span>   <span class="n">Bubar_SIGNAL</span>   <span class="n">B</span><span class="o">-</span>
<span class="n">ChargeConj</span>   <span class="n">Bu_SIGNAL</span>   <span class="n">Bubar_SIGNAL</span>
<span class="c1">#</span>
<span class="n">Alias</span>   <span class="n">MyTau</span><span class="o">+</span>   <span class="n">tau</span><span class="o">+</span>
<span class="n">Alias</span>   <span class="n">MyTau</span><span class="o">-</span>   <span class="n">tau</span><span class="o">-</span>
<span class="n">ChargeConj</span>   <span class="n">MyTau</span><span class="o">+</span>   <span class="n">MyTau</span><span class="o">-</span>
<span class="c1">#</span>
<span class="n">Decay</span> <span class="n">Bu_SIGNAL</span>
    <span class="mf">1.0</span>   <span class="n">MyTau</span><span class="o">+</span>   <span class="n">nu_tau</span>   <span class="n">SLN</span><span class="p">;</span>
<span class="n">Enddecay</span>
<span class="n">CDecay</span>   <span class="n">Bubar_SIGNAL</span>
<span class="c1">#</span>
<span class="n">Decay</span> <span class="n">MyTau</span><span class="o">-</span>
    <span class="mf">1.0</span>   <span class="n">pi</span><span class="o">-</span>   <span class="n">pi</span><span class="o">-</span>   <span class="n">pi</span><span class="o">+</span>   <span class="n">nu_tau</span>   <span class="n">TAUHADNU</span> <span class="o">-</span><span class="mf">0.108</span> <span class="mf">0.775</span> <span class="mf">0.149</span> <span class="mf">1.364</span> <span class="mf">0.400</span> <span class="mf">1.23</span> <span class="mf">0.4</span><span class="p">;</span>
<span class="n">Enddecay</span>
<span class="n">CDecay</span> <span class="n">MyTau</span><span class="o">+</span>
<span class="c1">#</span>
<span class="n">End</span>
</pre></div>
</div>
<p><strong>Using TAUOLA and PHOTOS in EvtGen</strong></p>
<p>EvtGen can interface with two optional external packages:</p>
<ul class="simple">
<li><p><strong>TAUOLA</strong> — precise <span class="math notranslate nohighlight">\(\tau\)</span> decay simulation with polarization</p></li>
<li><p><strong>PHOTOS</strong> — adds QED final-state radiation</p></li>
</ul>
<p>Both are included in the Key4HEP build of EvtGen.</p>
<p>To enable <strong>TAUOLA</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Decay</span> <span class="n">MyTau</span><span class="o">-</span>
    <span class="mf">1.0</span>   <span class="n">pi</span><span class="o">-</span>   <span class="n">pi</span><span class="o">-</span>   <span class="n">pi</span><span class="o">+</span>   <span class="n">nu_tau</span>   <span class="n">TAUOLA</span><span class="p">;</span>
<span class="n">Enddecay</span>
</pre></div>
</div>
<p>To enable <strong>PHOTOS</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Decay</span> <span class="n">Bu_SIGNAL</span>
    <span class="mf">1.0</span>   <span class="n">MyTau</span><span class="o">+</span>   <span class="n">nu_tau</span>   <span class="n">SLN</span> <span class="n">PHOTOS</span><span class="p">;</span>
<span class="n">Enddecay</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../../../FccFastSimGeneration.html" class="btn btn-neutral float-left" title="2.1. FCC: Getting started with event generation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../../eedE.html" class="btn btn-neutral float-right" title="2.3. Understanding generated process: eedE" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, CERN.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: flavours2025
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../../../../main/index.html">main</a></dd>
      <dd><a href="../../../../../../bnl2023/index.html">bnl2023</a></dd>
      <dd><a href="../../../../../../cern2022/index.html">cern2022</a></dd>
      <dd><a href="Readme.html">flavours2025</a></dd>
      <dd><a href="../../../../../../mit2024/index.html">mit2024</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>