<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.3. Using Guinea-Pig to generate interaction region backgrounds &mdash; FCC Tutorials  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom-admonitions.css?v=e6bfab01" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.4. Noble Liquid Calorimeter Full Simulation Exercise" href="../FccCaloPerformance/CaloFullSimExercise.html" />
    <link rel="prev" title="3.2. FCCee: Full Simulation of IDEA Driftchamber" href="../FCCeeDriftChamber/FCCeeDriftChamber.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            FCC Tutorials
              <img src="../../_static/fcc-logo-light.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../software-basics/README.html">1. First  Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fast-sim-and-analysis/README.html">2. Generators, Fast Simulation and Analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">3. Full Detector Simulations</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../FCCeeCLD/FCCeeCLD.html">3.1. FCCee: Full Simulation of CLD, the CLID detector for FCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FCCeeDriftChamber/FCCeeDriftChamber.html">3.2. FCCee: Full Simulation of IDEA Driftchamber</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.3. Using Guinea-Pig to generate interaction region backgrounds</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#generating-e-e-pairs-with-guinea-pig">3.3.1. Generating <span class="math notranslate nohighlight">\(e^{+} e^{-}\)</span> pairs with Guinea-Pig</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generating-large-amounts-of-data-with-guinea-pig">3.3.2. Generating large amounts of data with Guinea-Pig</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analysing-the-data-only-for-ilcsoft-users">3.3.3. Analysing the data (only for ILCSOFT users)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tracking-the-pairs-in-the-detector-using-key4hep">3.3.4. Tracking the pairs in the detector using Key4HEP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gp-production-of-gamma-gamma-hadrons">3.3.5. GP production of <span class="math notranslate nohighlight">\(\gamma\gamma\)</span> hadrons</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../FccCaloPerformance/CaloFullSimExercise.html">3.4. Noble Liquid Calorimeter Full Simulation Exercise</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FCCeeCaloPhotonPi0Discrimination/FCCeeCaloPhotonPi0Discrimination.html">3.5. FCC-ee photon/pi0 discrimination using noble liquid calorimeter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Geometry/Geometry.html">3.6. Changing geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Visualization/Visualization.html">3.7. Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed-computing/README.html">4. Distributed computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developing-fcc-software/README.html">5. Developing FCCSW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">6. Contributing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/FCCSW/">FCCSW main page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/FCCAnalyses/doc/latest/index.html">FCCAnalyses reference documentation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/glossary">FCC software glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">FCC Tutorials</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../README.html"><span class="section-number">3. </span>Full Detector Simulations</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3.3. </span>Using Guinea-Pig to generate interaction region backgrounds</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/HEP-FCC/fcc-tutorials/blob/main/full-detector-simulations/FCCeeGuineaPigIRBackgrounds/README.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="using-guinea-pig-to-generate-interaction-region-backgrounds">
<h1><span class="section-number">3.3. </span>Using Guinea-Pig to generate interaction region backgrounds<a class="headerlink" href="#using-guinea-pig-to-generate-interaction-region-backgrounds" title="Link to this heading"></a></h1>
<div class="objectives admonition">
<p class="admonition-title">Learning objectives</p>
<ul class="simple">
<li><p>get to know tools to  study FCCee interaction region backgrounds</p></li>
<li><p>know how to setup and use GuineaPig</p></li>
</ul>
</div>
<p>Guinea-Pig is included in releases of the FCC software and is developed at this repository:</p>
<p><a class="reference external" href="https://gitlab.cern.ch/clic-software/guinea-pig">https://gitlab.cern.ch/clic-software/guinea-pig</a></p>
<p>Issues and Pull Requests can be submitted there.</p>
<section id="generating-e-e-pairs-with-guinea-pig">
<h2><span class="section-number">3.3.1. </span>Generating <span class="math notranslate nohighlight">\(e^{+} e^{-}\)</span> pairs with Guinea-Pig<a class="headerlink" href="#generating-e-e-pairs-with-guinea-pig" title="Link to this heading"></a></h2>
<p>In order to run Guinea-Pig (hereafter GP) and generate e- e+ pair background, one should provide the relevant accelerator (beam) parameters, plus some steering parameters to run the software. Those parameters are set in the file acc.dat.
Currently, one can find the four following accelerators, where the beam parameters correspond to the values considered for FCC CDR (2019).</p>
<ul class="simple">
<li><p>FCCee Z working point (Ecm = 91.2 GeV): FCCee_Z</p></li>
<li><p>FCCee W working point (Ecm = 160 GeV): FCCee_W</p></li>
<li><p>FCCee ZH working point (Ecm = 240 GeV): FCCee_ZH</p></li>
<li><p>FCCee Top working point (Ecm = 365 GeV): FCCee_Top</p></li>
</ul>
<p>and the following 2 sets of configuration parameters:</p>
<ul class="simple">
<li><p>FCCee_Z</p></li>
<li><p>FCCee_Top</p></li>
</ul>
<p>It is recommended to run the FCCee Z accelerator together with the FCCee_Z parameters, while the other 3 accelerators can be run with the FCCee_Top parameters.</p>
<p>To run GP you should type the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>guinea<span class="w"> </span><span class="nv">$ACC</span><span class="w"> </span><span class="c1">#PAR output</span>
</pre></div>
</div>
<p>e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>guinea<span class="w"> </span>FCCee_Z<span class="w"> </span>FCCee_Z<span class="w"> </span>output
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">output</span></code> it is the produced log file, and it can be given any name. Below we will try to explain the main GP configuration parameters. Each GP run corresponds to 1 bunch crossing.</p>
</section>
<section id="generating-large-amounts-of-data-with-guinea-pig">
<h2><span class="section-number">3.3.2. </span>Generating large amounts of data with Guinea-Pig<a class="headerlink" href="#generating-large-amounts-of-data-with-guinea-pig" title="Link to this heading"></a></h2>
<p>One can use the script at:</p>
<p><a class="reference external" href="https://github.com/Voutsi/FCCee_IR_Backgrounds/blob/master/eepairs/sub_gp_pairs.sh">https://github.com/Voutsi/FCCee_IR_Backgrounds/blob/master/eepairs/sub_gp_pairs.sh</a></p>
<p>that sends a user defined number of bunch crossings to be generated in parallel in Condor. You should modify accordingly the following parts of the script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">nruns</span><span class="o">=</span><span class="m">100</span>
</pre></div>
</div>
<p>defines the number of bunch crossings to be generated</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ROOTDIR</span><span class="o">=</span>/afs/cern.ch/user/v/voutsina/Work/FCCeeBKG_WrapUp/eepairs
</pre></div>
</div>
<p>This variable defines the directory where the results will be stored. The script will generate there a new directory, data${i} for the ith generated bunch crossing.</p>
<p>Command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;s/rndm_seed=1/rndm_seed=&#39;</span><span class="si">${</span><span class="nv">nn</span><span class="si">}</span><span class="s1">&#39;/g&#39;</span><span class="w"> </span>acc.dat
</pre></div>
</div>
<p>Changes the random seed for the ith bunch crossing according to the pattern</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nv">nn</span><span class="o">=</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span>*100000
</pre></div>
</div>
<p>Feel free to modify the pattern, but have in mind that if you run N BXs with the same seed, you will generate N times the same data.</p>
<p>In the following line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/afs/cern.ch/user/v/voutsina/Work/testarea/CodeTest/GP++/guinea-pig.r3238/src/guinea<span class="w"> </span>FCCee_Top<span class="w"> </span>FCCee_Top<span class="w"> </span>output
</pre></div>
</div>
<p>you should replace the path where your guinea executable is located, the desired accelerator and configuration-parameters names and the desired output file name.</p>
<p>The queueing in Condor is defined by the following line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+JobFlavour<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;tomorrow&quot;</span>
</pre></div>
</div>
<p>For the set of parameters FCCee_Z, featuring an estimating running time of few hours, a job flavour “workday” is recommended. For the  set of parameters FCCee_Top, job flavour “longlunch” should be enough.</p>
</section>
<section id="analysing-the-data-only-for-ilcsoft-users">
<h2><span class="section-number">3.3.3. </span>Analysing the data (only for ILCSOFT users)<a class="headerlink" href="#analysing-the-data-only-for-ilcsoft-users" title="Link to this heading"></a></h2>
<p>Marlin processors can be used to analyse the simulated data. They were used for CDR results.
In order to compile them: please initialise ILCSoft environment first.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build<span class="p">;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-C<span class="w"> </span><span class="nv">$ILCSOFT</span>/ILCSoft.cmake<span class="w"> </span>..
make<span class="w"> </span>install
</pre></div>
</div>
</section>
<section id="tracking-the-pairs-in-the-detector-using-key4hep">
<h2><span class="section-number">3.3.4. </span>Tracking the pairs in the detector using Key4HEP<a class="headerlink" href="#tracking-the-pairs-in-the-detector-using-key4hep" title="Link to this heading"></a></h2>
<p>The incoherent e+e- pairs produced by GP for a bunch crossing are stored in the file <code class="docutils literal notranslate"><span class="pre">pairs.dat</span></code>, which can be directly read as input for full simulation in Key4HEP using the <code class="docutils literal notranslate"><span class="pre">MDIReader</span></code> tool.
This is used to boost the particles in the detector frame and shoot them in the detector using the particle gun.
An example on how to call this in the Key4HEP steering file is the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> 

<span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">MDIReader</span>
<span class="n">mdi_converter</span> <span class="o">=</span> <span class="n">MDIReader</span><span class="p">(</span><span class="s2">&quot;Reader&quot;</span><span class="p">,</span><span class="n">MDIFilename</span><span class="o">=</span><span class="s2">&quot;pairs.dat&quot;</span><span class="p">)</span>
<span class="n">mdi_converter</span><span class="o">.</span><span class="n">GenParticles</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;allGenParticles&quot;</span>
<span class="n">mdi_converter</span><span class="o">.</span><span class="n">CrossingAngle</span> <span class="o">=</span> <span class="mf">0.015</span>                     <span class="c1">#crossing angle [rad]</span>
<span class="n">mdi_converter</span><span class="o">.</span><span class="n">LongitudinalCut</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mdi_converter</span><span class="o">.</span><span class="n">InputType</span> <span class="o">=</span> <span class="s2">&quot;guineapig&quot;</span>                   <span class="c1">#flag to read GP files</span>
<span class="n">mdi_converter</span><span class="o">.</span><span class="n">BeamEnergy</span> <span class="o">=</span> <span class="mf">182.5</span>                        <span class="c1">#beam energy [GeV]</span>

<span class="o">...</span>

<span class="n">particle_converter</span> <span class="o">=</span> <span class="n">SimG4PrimariesFromEdmTool</span><span class="p">(</span><span class="s2">&quot;EdmConverter&quot;</span><span class="p">)</span>
<span class="n">particle_converter</span><span class="o">.</span><span class="n">GenParticles</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="s2">&quot;allGenParticles&quot;</span>

<span class="o">...</span>

<span class="n">geantsim</span> <span class="o">=</span> <span class="n">SimG4Alg</span><span class="p">(</span><span class="s2">&quot;SimG4Alg&quot;</span><span class="p">,</span>
                    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span>
		    <span class="c1">#your_list_of_outputs</span>
		    <span class="p">],</span>
                    <span class="n">eventProvider</span><span class="o">=</span><span class="n">particle_converter</span><span class="p">)</span>
                    
<span class="o">...</span>

<span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">ApplicationMgr</span>
<span class="n">ApplicationMgr</span><span class="p">(</span> <span class="n">TopAlg</span> <span class="o">=</span> <span class="p">[</span><span class="n">mdi_converter</span><span class="p">,</span> <span class="n">geantsim</span><span class="p">,</span> <span class="n">out</span><span class="p">],</span>
                <span class="n">EvtSel</span> <span class="o">=</span> <span class="s1">&#39;NONE&#39;</span><span class="p">,</span>
                <span class="n">EvtMax</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">ExtSvc</span> <span class="o">=</span> <span class="p">[</span><span class="n">podioevent</span><span class="p">,</span> <span class="n">geoservice</span><span class="p">,</span> <span class="n">geantservice</span><span class="p">],</span>
                <span class="n">OutputLevel</span><span class="o">=</span><span class="n">INFO</span>
               <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="gp-production-of-gamma-gamma-hadrons">
<h2><span class="section-number">3.3.5. </span>GP production of <span class="math notranslate nohighlight">\(\gamma\gamma\)</span> hadrons<a class="headerlink" href="#gp-production-of-gamma-gamma-hadrons" title="Link to this heading"></a></h2>
<p>In order to produce <span class="math notranslate nohighlight">\(\gamma\gamma\)</span> to hadrons with GP, we need to add the following commands inside the configuration file acc.dat</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">hadron_ratio</span><span class="o">=</span><span class="m">100000</span><span class="p">;</span>
<span class="nv">do_hadrons</span><span class="o">=</span><span class="m">3</span><span class="p">;</span>
<span class="nv">store_hadrons</span><span class="o">=</span><span class="m">1</span><span class="p">;</span>
</pre></div>
</div>
<p>while switching off pair production:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">do_pairs</span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">do_hadrons</span> <span class="pre">=</span> <span class="pre">3;</span></code> will make GP to produce a hadron.dat file, which contains the produced partons, with the same cross-section parametrisation as Pythia does. “hadron_ratio=100000;” is the weight factor with which the cross section of the
hadronic interaction is scaled. As a second step, we invoke Pythia to do the fragmentation. To do so, we use the “hades” library from Daniel Schulte, which allows to feed the GuineaPig’s output to Pythia. Finally we translate the Pythia’s output to .HEPEvt style events. To perform the last 2 steps, we can use the tar file at</p>
<p><a class="reference external" href="https://github.com/Voutsi/FCCee_IR_Backgrounds/blob/master/ggToHadrons/hadron.tar.gz">https://github.com/Voutsi/FCCee_IR_Backgrounds/blob/master/ggToHadrons/hadron.tar.gz</a></p>
<p>This file was made by Dominik Arominski, and contains the HADES library. Please unpack it and follow the instructions given in the README file.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../FCCeeDriftChamber/FCCeeDriftChamber.html" class="btn btn-neutral float-left" title="3.2. FCCee: Full Simulation of IDEA Driftchamber" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../FccCaloPerformance/CaloFullSimExercise.html" class="btn btn-neutral float-right" title="3.4. Noble Liquid Calorimeter Full Simulation Exercise" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, CERN.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: cern2022
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../main/index.html">main</a></dd>
      <dd><a href="../../../bnl2023/index.html">bnl2023</a></dd>
      <dd><a href="README.html">cern2022</a></dd>
      <dd><a href="../../../mit2024/index.html">mit2024</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>